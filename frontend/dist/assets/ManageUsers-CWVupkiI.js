import{r as l,j as e,am as q,an as p,ao as z,ap as L,aq as S,ar as K,as as M,D as O,at as R,l as i,t as X}from"./index-COxCwWZM.js";import{a as _}from"./authService-Bun0fk3r.js";import{F as Q}from"./Table-DOxAOJNf.js";import"./addEventListener-C0BB_NjA.js";import"./index-Cp1xowZ4.js";import"./Input-2CY0lWXu.js";import"./FileOutlined-PbY9D8ma.js";const{Option:b}=p,B=[{value:"all",label:"Tất cả"},{value:"user",label:"Người dùng"},{value:"artist",label:"Nghệ sĩ"},{value:"admin",label:"Admin"}],ae=()=>{const[u,C]=l.useState(""),[h,F]=l.useState("all"),[w,v]=l.useState([]),[N,j]=l.useState({}),[U,k]=l.useState([]),[V,y]=l.useState(!1),[E,T]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const t=await L();v(t.data.message),k(t.data.message)}catch(t){console.log("Lỗi lấy users ",t.message)}finally{T(!1)}})()},[]),l.useEffect(()=>{let a=[...w];h!=="all"&&(a=a.filter(t=>t.role===h)),u&&(a=a.filter(t=>t.name.toLowerCase().includes(u.toLowerCase()))),k(a)},[h,u,w]);const A=(a,t)=>{a==="edit"?j(t):a==="delete"&&console.log("Xóa:",t)},I=[{title:"",dataIndex:"avatar",key:"avatar",render:a=>e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{loading:"lazy",src:a||"/user.png",alt:"Ảnh đại diện",className:"w-10 h-auto aspect-square rounded-full object-cover"})})},{title:"Email",dataIndex:"email",key:"email"},{title:"Họ và tên",dataIndex:"name",key:"name"},{title:"Tham gia",dataIndex:"created_at",key:"created_at"},{title:"Quyền",dataIndex:"role",key:"role"},{title:"Trạng thái",dataIndex:"status",key:"status",render:a=>a===1?e.jsx("span",{className:"text-green-500",children:"Hoạt động"}):e.jsx("span",{className:"text-red-500",children:"Khóa"})},{title:"",key:"action",render:a=>e.jsx(O,{menu:{items:[{key:"edit",label:"Chỉnh sửa"},{key:"delete",label:"Xóa",danger:!0}],onClick:({key:t})=>A(t,a)},trigger:["click"],children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(R,{className:"text-gray-500 hover:text-[var(--main-green)]"})})})}],D=()=>{const[a,t]=l.useState(""),[m,c]=l.useState(""),[x,g]=l.useState(""),[o,f]=l.useState(!1),r=async s=>{s.preventDefault();try{const d={name:a,email:m,password:x};i.loading({content:"Đang tạo tài khoản...",key:"add"});const n=await _(d);(n==null?void 0:n.data.status)===201&&(console.log(n),v(P=>[...P,n.data.data.user]),y(!1),t(""),c(""),g(""),i.success({content:n.data.message,key:"add",duration:2}))}catch(d){console.error("API Error",d),i.error({content:d.message,key:"add",duration:2})}};return e.jsx("div",{className:"z-10 absolute top-0 left-0 w-full h-full bg-black/80 flex flex-col items-center justify-center gap-2",children:e.jsxs("div",{className:"flex flex-col gap-2 w-1/4 ",children:[e.jsx(S,{className:"text-white text-3xl cursor-pointer self-end translate-x-[100%]",onClick:()=>y(!1)}),e.jsx("form",{onSubmit:r,className:"p-2 bg-[var(--dark-gray)] rounded-md w-full shadow-md h-fit flex flex-col gap-3",children:e.jsxs("div",{className:"flex flex-col gap-5  p-2",children:[e.jsx("label",{htmlFor:"name",children:"Tên người dùng"}),e.jsx("input",{required:!0,className:"outline-none border-1 border-[var(--light-gray2)] rounded-sm p-1",name:"name",type:"text",value:a,onChange:s=>t(s.target.value)}),e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{required:!0,className:"outline-none border-1 border-[var(--light-gray2)] rounded-sm p-1",name:"email",type:"email",value:m,onChange:s=>c(s.target.value)}),e.jsx("label",{htmlFor:"password",children:"Mật khẩu"}),e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("input",{required:!0,className:"outline-none border-1 border-[var(--light-gray2)] rounded-sm p-1",name:"password",type:o?"text":"password",value:x,onChange:s=>g(s.target.value)}),o?e.jsx(K,{className:"text-[var(--light-gray3)] cursor-pointer",onClick:()=>f(!o)}):e.jsx(M,{className:"text-[var(--light-gray3)] cursor-pointer",onClick:()=>f(!o)})]}),e.jsx("button",{className:"cursor-pointer self-center bg-[var(--light-gray2)] w-fit text-white p-2 rounded-sm",type:"submit",children:"Thêm người dùng"})]})})]})})},H=({user:a})=>{const[t,m]=l.useState(a.role),[c,x]=l.useState(a.status),g=[{value:"user",label:"Người dùng"},{value:"artist",label:"Nghệ sĩ"},{value:"admin",label:"Admin"}],o=[{value:a.status,label:a.status==1?"Hoạt động":"Khóa"}];a.status==1&&o.push({value:0,label:"Khóa"}),a.status==0&&o.push({value:1,label:"Hoạt động"});const f=async()=>{let r={};if(t!=a.role&&(console.log(t),r.role=t),c!=a.status&&(r.status=c),Object.keys(r).length>0)try{i.loading({content:"Đang lưu...",key:"update"});const s=await X(a.id,r);(s==null?void 0:s.status)===200&&(console.log(s),v(d=>d.map(n=>n.id===a.id?s.data.message:n)),j({}),i.success({content:"Cập nhật người dùng thành công",key:"update",duration:2}))}catch(s){i.success({content:s,key:"update",duration:2})}else i.error("Vui lòng chọn giá trị")};return e.jsx("div",{className:"z-10 absolute top-0 left-0 w-full h-full bg-black/80 flex flex-col items-center justify-center gap-2",children:e.jsxs("div",{className:"flex flex-col gap-2 w-1/4",children:[e.jsx(S,{className:"text-white text-3xl cursor-pointer self-end translate-x-[100%]",onClick:()=>j({})}),e.jsxs("div",{className:"p-5 bg-[var(--dark-gray)] rounded-md shadow-md w-full h-fit flex flex-col gap-5",children:[e.jsxs("div",{className:"flex gap-5 items-center w-full h-fit ",children:[e.jsx("img",{loading:"lazy",src:a.avatar,alt:"Ảnh người dùng",className:"w-1/3 h-auto object-cover rounded-md "}),e.jsxs("div",{className:"text-white flex flex-col gap-2",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.name}),e.jsx("div",{className:"text-sm text-gray-400",children:a.created_at})]})]}),e.jsxs("div",{className:"flex gap-5 items-center ",children:["Quyền:",e.jsx(p,{style:{width:120},onChange:m,defaultValue:t,children:g.map((r,s)=>e.jsx(b,{value:r.value,children:r.label},s))})]}),e.jsxs("div",{className:"flex gap-5 items-center",children:["Trạng thái:",e.jsx(p,{style:{width:120},onChange:x,defaultValue:c,children:o.map(r=>e.jsx(e.Fragment,{children:r.value!==-1&&e.jsx(b,{value:r.value,children:r.label},r.value)}))})]}),e.jsx("button",{onClick:f,className:"cursor-pointer self-center bg-[var(--light-gray2)] w-fit text-white p-2 rounded-sm my-2",children:"Lưu"})]})]})})};return e.jsx("div",{children:E?e.jsx("div",{className:"loader-container min-h-[50vh] flex justify-center items-center",children:e.jsx("span",{className:"loader",children:" "})}):e.jsxs("div",{className:"flex flex-col gap-7",children:[V&&e.jsx(D,{}),!!Object.keys(N).length&&e.jsx(H,{user:N}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Họ và tên",className:"bg-[var(--light-gray2)] text-white p-2 rounded-full w-full focus:outline-none placeholder-[var(--light-gray3)] text-sm pl-10",value:u,onChange:a=>C(a.target.value)}),e.jsx(q,{className:"absolute left-2 top-0 translate-x-[50%] translate-y-[50%] text-[var(--light-gray3)]"})]}),e.jsx(p,{style:{width:120},placeholder:"Chọn một mục",onChange:F,defaultValue:h,children:B.map(a=>e.jsx(b,{value:a.value,children:a.label},a.value))})]}),e.jsx(z,{onClick:()=>y(!0),className:"cursor-pointer hover:text-white text-[var(--main-green)] text-2xl"})]}),e.jsx(Q,{columns:I,dataSource:U,pagination:{pageSize:6},scrollToFirstRowOnChange:!0,rowKey:"email"})]})})};export{ae as default};
