import{a as E,r as c,c as U,j as e,am as q,bt as z,an as g,b as B,bu as v,D as P,bv as Y,al as R,bx as H,v as W,au as X}from"./index-CkHhWBjh.js";import{F as d,U as $}from"./UploadImage-BE5pLoZO.js";import{M as G,D as J}from"./index-D07JnVZb.js";import{I as K}from"./index-Bt6Yjdfu.js";import"./row-BFFtkFRa.js";import"./addEventListener-1zo4ObUy.js";import"./Input-BpZDHFDz.js";const{Option:b}=g,Q=[{value:-1,label:"Tất cả"},{value:0,label:"Riêng tư"},{value:1,label:"Công khai"}],ne=()=>{var j;const i=E(a=>a.user.user),[p,w]=c.useState(""),[h,y]=c.useState(-1),[C,m]=c.useState(!1),[o]=d.useForm(),N=U(),[u,f]=c.useState(!1),k=({options:a,onChange:t})=>e.jsx(g,{style:{width:100},placeholder:"Chọn một mục",onChange:t,defaultValue:h,children:a.map(l=>e.jsx(b,{value:l.value,children:l.label},l.value))}),S=a=>{w(a.target.value)},D=a=>{y(a)},F=()=>{const a=[{key:"1",label:"Cập nhật",onClick:()=>alert("Clicked on 1st menu item")},{key:"2",label:"Xóa",onClick:()=>alert("Clicked on 2nd menu item")}];return e.jsx(P,{menu:{items:a},trigger:["click"],children:e.jsx(Y,{})})},V=({type:a})=>{m(!0),m(!0)},_=async({type:a})=>{try{f(!0);const t=await o.validateFields();a==="add"&&await I(t),m(!1),o.resetFields()}catch(t){console.log("Validation Failed:",t)}finally{f(!1)}},I=async a=>{try{let t="";if(a.image){const n=new FormData;n.append("file",a.image);const s=await R(n);if(s.status===200)t=encodeURI(s.data.message);else throw new Error("Image upload failed")}const l={name:a.name,artist_id:i.id,image:t,release_date:a.release_date},r=await H(l);if((r==null?void 0:r.status)===201){const n={...i,albums_data:[...i.albums_data,r.data.message]};N(W(n)),await Promise.all(a.songs.map(async s=>{try{await X(s,{album_id:r.data.message.id})}catch(x){console.error(`❌ Cập nhật thất bại cho song ${s}`,x)}}))}else throw new Error("Failed to add album")}catch(t){console.error("Error adding song:",t)}},M=()=>{m(!1)},A=()=>e.jsx(G,{title:"Thêm album mới",open:C,onOk:()=>_({type:"add"}),onCancel:M,okText:u?e.jsx(v,{}):"Submit",cancelText:"Cancel",width:700,confirmLoading:u,children:u?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang xử lý..."]}):e.jsx(d,{form:o,layout:"vertical",children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("div",{className:"w-fit border-r-1 border-black pr-4",children:e.jsx(d.Item,{label:"Image",name:"image",rules:[{required:!0,message:"Vui lòng chọn ảnh bài hát!"}],children:e.jsx($,{form:o})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d.Item,{label:"Tên album",name:"name",rules:[{required:!0,message:"Vui lòng nhập tên album!"}],children:e.jsx(K,{className:"!w-[300px]"})}),e.jsx(d.Item,{label:"Ngày phát hành",name:"release_date",rules:[{required:!0,message:"Vui lòng chọn ngày phát hành!"}],children:e.jsx(L,{form:o})}),e.jsx(d.Item,{label:"Bài hát trong album",name:"songs",children:e.jsx(O,{data:i.songs_data.filter(a=>a.status!=2&&a.album_id==""),form:o})})]})]})})}),L=({form:a})=>{const[t,l]=c.useState(null),r=(n,s)=>{l(s),a.setFieldsValue({release_date:s})};return e.jsx("div",{children:e.jsx(J,{onChange:r,format:"YYYY-MM-DD"})})},O=({data:a,form:t})=>{const[l,r]=c.useState([]),n=s=>{r(s),t.setFieldsValue({songs:s})};return e.jsx("div",{children:e.jsx(g,{mode:"multiple",value:l,onChange:n,placeholder:"Chọn nhiều",style:{width:"100%"},showSearch:!0,filterOption:(s,x)=>x.children.toLowerCase().includes(s.toLowerCase()),children:a.map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))})})},T=({album:a})=>(B(),e.jsxs("div",{className:"relative w-40 bg-[var(--light-gray2)] h-fit p-3 rounded-lg transition-transform transform hover:scale-105 duration-300 cursor-pointer flex flex-col",children:[e.jsx("img",{loading:"lazy",src:a.image,alt:a.name,className:"w-full h-32 object-cover aspect-square rounded-sm"}),e.jsxs("div",{className:"w-full mt-2 flex flex-col gap-2",children:[e.jsx("div",{className:"text-white font-semibold overflow-hidden whitespace-nowrap text-ellipsis w-full",children:a.name}),e.jsx("div",{className:"text-gray-400 text-sm",children:a.release_date})]}),e.jsx("div",{className:"z-1 absolute bottom-0 right-0 hover:text-white translate-x-[-50%] translate-y-[-100%]",children:e.jsx(F,{})}),a.status==0&&e.jsx("div",{className:"absolute top-0 left-0 bg-[var(--light-gray1)] opacity-50  transition-opacity duration-300  bottom-0 right-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-gray-500 text-sm font-semibold flex items-center gap-2",children:[e.jsx(v,{})," Riêng tư"]})})]}));return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center justify-between m-5 mb-7",children:[i.albums_data==null?e.jsx("div",{className:"text-center text-white text-sm",children:"Bạn chưa có album nào"}):e.jsxs("div",{className:"flex items-center gap-5 ",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Nhập tên album",className:"bg-[var(--light-gray2)] !text-white p-2 rounded-full w-96 focus:outline-none placeholder-[var(--light-gray3)] text-sm pl-10",value:p,onChange:S}),e.jsx(q,{className:"absolute left-2 top-0 translate-x-[50%] translate-y-[50%] text-[var(--light-gray3)]"})]}),e.jsx(k,{options:Q,onChange:D})]}),e.jsxs("div",{onClick:()=>V({type:"add"}),className:"group rounded-xl transition-all duration-300 hover:bg-[var(--main-green)] hover:text-black text-[var(--light-gray3)] text-base cursor-pointer w-fit bg-[var(--light-gray1)] p-2 flex items-center gap-2",children:[e.jsx(z,{}),e.jsx("span",{className:"hidden group-hover:inline text-xs ",children:"Thêm album"})]})]}),e.jsx("div",{className:"h-[70vh] overflow-y-auto  custom-scroll",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5 justify-items-center",children:(j=i.albums_data)==null?void 0:j.map((a,t)=>a.status!=2&&a.name.toLowerCase().includes(p.toLowerCase())&&(h==-1||a.status==h)&&e.jsx(T,{album:a},t))})}),e.jsx(A,{})]})};export{ne as default};
