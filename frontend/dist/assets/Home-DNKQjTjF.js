import{u as w,a as d,b as y,j as e,c as A,r as f,f as D,d as S,s as k,e as C,g as p,h as j,i as v}from"./index-CkHhWBjh.js";import{A as P}from"./AlbumCard-Bp6c5Kx1.js";import{A as _}from"./ArtistCard-zUPjeqnn.js";const b=({song:t})=>{var o;const{formatTime:c,handleClickSong:g}=w(),n=d(i=>i.music.currentSong),l=(n==null?void 0:n.id)===t.id,m=y();return e.jsxs("div",{className:"w-full cursor-pointer flex gap-3 shadow-lg overflow-hidden items-center hover:bg-[var(--light-gray1)] p-2 rounded-sm",onClick:()=>{g(t.id),m(`/song/${t.id}`)},children:[e.jsx("img",{loading:"lazy",src:t.image,alt:"Album Cover",className:"w-15 h-15 object-cover aspect-square rounded-sm"}),e.jsxs("div",{className:"text-[var(--light-gray3)] w-full flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-center",children:[e.jsx("div",{className:"text-base font-semibold text-white w-full overflow-hidden whitespace-nowrap text-ellipsis",style:l?{color:"var(--main-green)",fontSize:"18px"}:{},children:t.name}),e.jsx("span",{className:`${t.price!==0?"bg-[var(--main-green)]":"transparent"} text-black text-xs px-2 py-1 rounded-sm font-semibold`,children:t.price!==0?"Premium":""})]}),e.jsx("div",{className:"text-xs",children:(o=t.artists_data)==null?void 0:o.map((i,x)=>e.jsxs("span",{className:"cursor-pointer hover:text-white",onClick:s=>{s.stopPropagation(),m(`/artist/${i.id}`)},children:[i.name,x<t.artists_data.length-1?", ":""]},i.id))}),e.jsxs("div",{className:"text-xs mt-1 flex justify-between",children:[e.jsx("span",{children:t.date}),e.jsx("span",{children:c(t.duration)})]})]})]})},$=()=>{const t=d(s=>s.user.user),c=d(s=>s.music.songs),g=d(s=>s.music.albums),n=d(s=>s.music.artists);y();const l=A(),[m,o]=f.useState(!1);f.useEffect(()=>{(async()=>{o(!0);try{const[a,r]=await Promise.all([D(),S()]);l(k(a.data.message)),l(C(r.data.message))}catch(a){console.error("Lỗi khi tải albums/artists:",a)}})()},[]),f.useEffect(()=>{(async()=>{if(!t||(t==null?void 0:t.purchases_data.length)==0){try{const r=(await p()).data.message.filter(h=>h.status==1);l(j(r)),l(v(r))}catch(a){console.error("Lỗi khi tải hoặc xử lý songs:",a)}finally{o(!1)}return}try{let r=(await p()).data.message;if(t.purchases_data.length>0){const h=t.purchases_data[0],u=new Date(h.purchase_date);u.setDate(u.getDate()+h.date),u>=new Date&&(r=r.map(N=>({...N,price:0})))}l(j(r)),l(v(r))}catch(a){console.error("Lỗi khi tải hoặc xử lý songs:",a)}finally{o(!1)}})()},[]);const i=({title:s})=>e.jsx("div",{className:"flex justify-between items-center text-green-500 mb-10",children:e.jsx("h2",{className:"text-white text-2xl font-bold",children:s})}),x=()=>e.jsxs("div",{className:"my-8",children:[e.jsx(i,{title:"Popular Artists"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-5",children:n.filter(s=>s.status!==0).slice(0,6).map((s,a)=>s.status!==0&&e.jsx(_,{artist:s},a))})]});return m?e.jsx("div",{className:"loader-container min-h-[50vh]",children:e.jsx("span",{className:"loader",children:" "})}):e.jsxs("div",{className:"bg-gradient-to-tl from-stone-900 to-neutral-700 p-6 py-10 min-h-screen flex flex-col gap-20 ",children:[e.jsxs("div",{children:[e.jsx(i,{title:"Popular Albums"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 2xl:grid-cols-6 gap-5",children:g.filter(s=>s.status===1).slice(0,6).map((s,a)=>s.status===1&&e.jsx(P,{album:s},a))})]}),e.jsx(x,{}),c.length!==0&&e.jsxs("div",{children:[e.jsx(i,{title:"Thịnh hành"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5",children:c.filter(s=>s.status===1).slice(0,12).map((s,a)=>s.status===1&&e.jsx(b,{song:s},a))})]}),c.length!==0&&e.jsxs("div",{children:[e.jsx(i,{title:"Mới phát hành"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5",children:c.filter(s=>s.status===1).slice(12,16).map((s,a)=>s.status===1&&e.jsx(b,{song:s},a))})]})]})};export{$ as default};
