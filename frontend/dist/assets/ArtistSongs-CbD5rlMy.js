import{r as n,I as te,_ as ae,br as se,bs as re,a as le,c as ne,j as e,am as ie,bt as oe,d as ce,n as de,an as I,bu as R,D as ue,bv as me,ac as _,al as F,bw as he,v as pe}from"./index-CkHhWBjh.js";import{F as x,U as ge,a as U}from"./UploadImage-BE5pLoZO.js";import{D as M,M as xe}from"./index-D07JnVZb.js";import{I as fe}from"./index-Bt6Yjdfu.js";import{R as je}from"./FileOutlined-CCgYKKmr.js";import"./row-BFFtkFRa.js";import"./addEventListener-1zo4ObUy.js";import"./Input-BpZDHFDz.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 302.3L784 376V224c0-35.3-28.7-64-64-64H128c-35.3 0-64 28.7-64 64v576c0 35.3 28.7 64 64 64h592c35.3 0 64-28.7 64-64V648l128 73.7c21.3 12.3 48-3.1 48-27.6V330c0-24.6-26.7-40-48-27.7zM712 792H136V232h576v560zm176-167l-104-59.8V458.9L888 399v226zM208 360h112c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H208c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"video-camera",theme:"outlined"},be=function(h,m){return n.createElement(te,ae({},h,{ref:m,icon:ve}))},we=n.forwardRef(be),ye=function(c,h){var m={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&h.indexOf(o)<0&&(m[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,o=Object.getOwnPropertySymbols(c);d<o.length;d++)h.indexOf(o[d])<0&&Object.prototype.propertyIsEnumerable.call(c,o[d])&&(m[o[d]]=c[o[d]]);return m};const{TimePicker:Ce,RangePicker:Ne}=M,Ve=n.forwardRef((c,h)=>n.createElement(Ne,Object.assign({},c,{picker:"time",mode:void 0,ref:h}))),w=n.forwardRef((c,h)=>{var{addon:m,renderExtraFooter:o,variant:d,bordered:V}=c,y=ye(c,["addon","renderExtraFooter","variant","bordered"]);const[S]=se("timePicker",d,V),v=n.useMemo(()=>{if(o)return o;if(m)return m},[m,o]);return n.createElement(Ce,Object.assign({},y,{mode:void 0,ref:h,renderExtraFooter:v,variant:S}))}),T=re(w,"popupAlign",void 0,"picker");w._InternalPanelDoNotUseOrYouWillBeFired=T;w.RangePicker=Ve;w._InternalPanelDoNotUseOrYouWillBeFired=T;const{Option:A}=I,Se=[{value:-1,label:"Tất cả"},{value:0,label:"Riêng tư"},{value:1,label:"Công khai"}],Ue=()=>{const[c,h]=n.useState([]),[m,o]=n.useState([]),d=le(t=>t.user.user),V=ne(),[y,S]=n.useState(""),[v,E]=n.useState(-1),[k,C]=n.useState(!1),[P,N]=n.useState(!1),[p]=x.useForm();n.useEffect(()=>{if(!k)return;(async()=>{N(!0);try{const[a,s]=await Promise.all([ce(),de()]);o(s.data.message),h(a.data.message)}catch(a){console.error("Lỗi khi tải dữ liệu:",a)}finally{N(!1)}})()},[k]);const L=t=>{S(t.target.value)},z=({options:t,onChange:a})=>e.jsx(I,{style:{width:100},placeholder:"Chọn một mục",onChange:a,defaultValue:v,children:t.map(s=>e.jsx(A,{value:s.value,children:s.label},s.value))}),q=t=>{E(t)},Y=({type:t})=>{C(!0),C(!0)},B=async({type:t})=>{try{N(!0);const a=await p.validateFields();t==="add"&&await H(a),C(!1),p.resetFields()}catch(a){console.log("Validation Failed:",a)}finally{N(!1)}},H=async t=>{try{let a="",s="",u="";const i=[];if(t.image){const g=new FormData;g.append("file",t.image);const b=F(g).then(f=>{if(f.status===200)return f.data.message;throw new Error("Image upload failed")});i.push(b)}else i.push(Promise.resolve(""));if(t.file_url){const g=new FormData;g.append("file",t.file_url);const b=F(g).then(f=>{if(f.status===200)return f.data.message;throw new Error("Audio upload failed")});i.push(b)}else i.push(Promise.resolve(""));if(t.video_url){const g=new FormData;g.append("file",t.video_url);const b=F(g).then(f=>{if(f.status===200)return f.data.message;throw new Error("Video upload failed")});i.push(b)}else i.push(Promise.resolve(""));const[r,l,j]=await Promise.all(i);a=r,s=l,u=j;const ee={name:t.name,image:encodeURI(a),date:t.date,duration:t.duration,artists:Array.isArray(t.artists)?[...t.artists,d.id]:[d.id],categories:t.categories,file_url:encodeURI(s),video_url:encodeURI(u)},O=await he(ee);if(O.status===201){const g={...d,songs_data:[...d.songs_data,O.data.message]};V(pe(g))}else throw new Error("Failed to add song")}catch(a){console.error("Error adding song:",a)}},W=()=>{C(!1)},$=()=>e.jsx(xe,{title:"Thêm bài hát mới",open:k,onOk:()=>B({type:"add"}),onCancel:W,okText:P?e.jsx(R,{}):"Submit",cancelText:"Cancel",width:700,confirmLoading:P,children:P?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang xử lý..."]}):e.jsx(x,{form:p,layout:"vertical",children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs("div",{className:"w-fit border-r-1 border-black pr-4",children:[e.jsx(x.Item,{label:"Image",name:"image",rules:[{required:!0,message:"Vui lòng chọn ảnh bài hát!"}],children:e.jsx(ge,{form:p})}),e.jsx(x.Item,{label:"Nhạc",name:"file_url",rules:[{required:!0,message:"Vui lòng chọn file nhạc bài hát!"}],children:e.jsx(X,{form:p})}),e.jsx(x.Item,{label:"Video",name:"video_url",children:e.jsx(G,{form:p})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x.Item,{label:"Tên bài hát",name:"name",rules:[{required:!0,message:"Vui lòng nhập tên bài hát!"}],children:e.jsx(fe,{className:"!w-[300px]"})}),e.jsx(x.Item,{label:"Ngày phát hành",name:"date",rules:[{required:!0,message:"Vui lòng chọn ngày phát hành!"}],children:e.jsx(J,{form:p})}),e.jsx(x.Item,{label:"Thời lượng",name:"duration",rules:[{required:!0,message:"Vui lòng chọn thời lượng bài hát!"}],children:e.jsx(K,{form:p})}),e.jsx(x.Item,{label:"Nghệ sĩ liên quan",name:"artists",children:e.jsx(D,{data:c,form:p,type:"artists"})}),e.jsx(x.Item,{label:"Thể loại nhạc",name:"categories",rules:[{required:!0,message:"Vui lòng chọn thể loại bài hát!"}],children:e.jsx(D,{data:m,form:p,type:"categories"})})]})]})})}),X=({form:t})=>{const[a,s]=n.useState(null),u=i=>{const r=i.file;s(r),t.setFieldsValue({file_url:i.file})};return e.jsxs("div",{className:"p-2 border-t-1 border-black",children:[a&&e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:URL.createObjectURL(a),type:"audio/mpeg"}),"Your browser does not support the audio tag."]},a.name),e.jsx("p",{children:a.name})]}),e.jsx(U,{showUploadList:!1,beforeUpload:()=>!1,onChange:u,accept:"audio/*",children:e.jsx(_,{icon:e.jsx(je,{}),children:"Select MP3"})})]})},G=({form:t})=>{const[a,s]=n.useState(null),u=i=>{const r=i.file;s(r),t.setFieldsValue({video_url:i.file})};return e.jsxs("div",{className:" p-2 border-t-1 border-black",children:[a&&e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("video",{width:"300",controls:!0,children:[e.jsx("source",{src:URL.createObjectURL(a),type:"video/mp4"}),"Your browser does not support the video tag."]},a.name),e.jsx("p",{children:a.name})]}),e.jsx(U,{showUploadList:!1,beforeUpload:()=>!1,onChange:u,accept:"video/*",children:e.jsx(_,{icon:e.jsx(we,{}),children:"Select Video"})})]})},J=({form:t})=>{const[a,s]=n.useState(null),u=(i,r)=>{s(r),t.setFieldsValue({date:r})};return e.jsx("div",{children:e.jsx(M,{onChange:u,format:"YYYY-MM-DD"})})},K=({form:t})=>{const[a,s]=n.useState(null),u=r=>{if(r){const l=r.minute()*60+r.second();s(l),t.setFieldsValue({duration:l})}else s(null)},i=()=>({disabledHours:()=>Array.from({length:24},(r,l)=>l!==0?l:null).filter(r=>r!==null),disabledMinutes:r=>r===0?Array.from({length:60},(l,j)=>j>=10?j:null).filter(l=>l!==null):[],disabledSeconds:()=>[]});return e.jsx("div",{children:e.jsx(w,{onChange:u,format:"mm:ss",showNow:!0,disabledTime:i})})},D=({type:t,data:a,form:s})=>{const[u,i]=n.useState([]),r=l=>{i(l),s.setFieldsValue({[t]:l})};return e.jsx("div",{children:e.jsx(I,{mode:"multiple",value:u,onChange:r,placeholder:"Chọn nhiều",style:{width:"100%"},showSearch:!0,filterOption:(l,j)=>j.children.toLowerCase().includes(l.toLowerCase()),children:a.map(l=>e.jsx(A,{value:l.id,children:l.name},l.id))})})},Q=()=>{const t=[{key:"1",label:"Cập nhật",onClick:()=>alert("Clicked on 1st menu item")},{key:"2",label:"Xóa",onClick:()=>alert("Clicked on 2nd menu item")}];return e.jsx(ue,{menu:{items:t},trigger:["click"],children:e.jsx(me,{})})};function Z({song:t}){var a;return e.jsxs("div",{className:"relative group w-[100%] cursor-pointer flex gap-3 max-w-xs shadow-lg overflow-hidden items-center hover:bg-[var(--light-gray2)] p-2 rounded-sm",children:[e.jsx("img",{loading:"lazy",src:t.image,alt:"Album Cover",className:"group-hover:scale-105 w-15 h-15 object-cover aspect-square rounded-sm"}),e.jsxs("div",{className:"text-[var(--light-gray3)] w-full flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-center",children:[e.jsx("div",{className:"text-base  font-semibold text-white w-full overflow-hidden whitespace-nowrap text-ellipsis",children:t.name}),e.jsx("span",{className:`${Number(t.price)!==0?"bg-[var(--main-green)]":"transparent"} text-black text-sm px-2 py-1 rounded-sm font-semibold`,children:t.price!=0?t.price:""})]}),e.jsx("div",{className:"text-xs",children:(a=t.artists_data)==null?void 0:a.map(s=>s.name).join(", ")}),e.jsx("div",{className:"text-xs mt-1 flex justify-between",children:e.jsx("span",{children:t.date})})]}),e.jsx("div",{className:"z-1 absolute bottom-2 right-0 hover:text-white",children:e.jsx(Q,{})}),t.status==0&&e.jsx("div",{className:"absolute top-0 left-0 bg-[var(--light-gray1)] opacity-50 transition-opacity duration-300 bottom-0 right-0 flex items-center justify-center z-0 pointer-events-none",children:e.jsxs("div",{className:"text-gray-500 text-sm font-semibold flex items-center gap-2",children:[e.jsx(R,{})," Riêng tư"]})})]})}return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center justify-between m-5 mb-7",children:[e.jsxs("div",{className:"flex items-center gap-5 ",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Nhập tên bài hát",className:"bg-[var(--light-gray2)] !text-white p-2 rounded-full w-96 focus:outline-none placeholder-[var(--light-gray3)] text-sm pl-10",value:y,onChange:L}),e.jsx(ie,{className:"absolute left-2 top-0 translate-x-[50%] translate-y-[50%] text-[var(--light-gray3)]"})]}),e.jsx(z,{options:Se,onChange:q})]}),e.jsxs("div",{onClick:()=>Y({type:"add"}),className:"group rounded-xl transition-all duration-300 hover:bg-[var(--main-green)] hover:text-black text-[var(--light-gray3)] text-base cursor-pointer w-fit bg-[var(--light-gray1)] p-2 flex items-center gap-2",children:[e.jsx(oe,{}),e.jsx("span",{className:"hidden group-hover:inline text-xs ",children:"Thêm bài hát"})]})]}),e.jsx("div",{className:"h-[60vh] overflow-y-auto  custom-scroll",children:e.jsx("div",{className:"grid grid-cols-1  md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-5 justify-items-center",children:d.songs_data.map((t,a)=>e.jsx(e.Fragment,{children:t.status!=2&&t.name.toLowerCase().includes(y.toLowerCase())&&(v==-1||t.status==v)&&e.jsx(Z,{song:t},a)}))})}),e.jsx($,{})]})};export{Ue as default};
