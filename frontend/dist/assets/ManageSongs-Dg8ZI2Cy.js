import{r as l,u as L,j as a,am as z,an as d,g as B,aq as D,D as O,at as P,au as q,l as h}from"./index-DiFjIO8C.js";import{F as U}from"./Table-BafvBFDD.js";import"./addEventListener-BrcnYScW.js";import"./index-BaCdUP48.js";import"./Input-BelQkl0O.js";import"./FileOutlined-BnszL7sh.js";const{Option:x}=d,H=[{value:-1,label:"Tất cả"},{value:0,label:"Riêng tư"},{value:1,label:"Công khai"},{value:3,label:"Chờ duyệt"}],W=()=>{const[r,y]=l.useState(""),[c,b]=l.useState(-1),[m,g]=l.useState([]),[N,f]=l.useState([]),{formatTime:S}=L(),[p,u]=l.useState({}),[w,k]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const t=await B();g(t.data.message),f(t.data.message)}catch(t){console.log("Lỗi lấy bài hát: ",t)}finally{k(!1)}})()},[]),l.useEffect(()=>{let e=[...m];c!==-1&&(e=e.filter(t=>t.status===c)),r&&(e=e.filter(t=>t.name.toLowerCase().includes(r.toLowerCase()))),f(e)},[c,r,m]);const C=(e,t)=>{e==="edit"&&u(t)},V=[{title:"",dataIndex:"image",key:"image",render:e=>a.jsx("div",{className:"flex justify-center",children:a.jsx("img",{loading:"lazy",src:e,alt:"Ảnh bài hát",className:"w-10 h-auto aspect-square rounded-sm object-cover"})})},{title:"Tên bài hát",dataIndex:"name",key:"name"},{title:"Phát hành",dataIndex:"date",key:"date"},{title:"Thời lượng",dataIndex:"duration",key:"duration",render:e=>S(e)},{title:"Nghệ sĩ",dataIndex:"artists_data",key:"artists_data",render:e=>e==null?void 0:e.map(t=>t.name).join(", ")},{title:"Thể loại",dataIndex:"categories_data",key:"categories_data",render:e=>e==null?void 0:e.map(t=>t.name).join(", ")},{title:"Nghe",dataIndex:"price",key:"price",render:e=>e!=0?"Premium":"Miễn phí"},{title:"Trạng thái",dataIndex:"status",key:"status",render:e=>e===1?a.jsx("span",{className:"text-green-500",children:"Công khai"}):e===3?a.jsx("span",{className:"text-yellow-500",children:"Chờ duyệt"}):a.jsx("span",{className:"text-red-500",children:"Riêng tư"})},{title:"",key:"action",render:e=>a.jsx(O,{menu:{items:[{key:"edit",label:"Chỉnh sửa"}],onClick:({key:t})=>C(t,e)},trigger:["click"],children:a.jsx("span",{className:"cursor-pointer",children:a.jsx(P,{className:"text-gray-500 hover:text-[var(--main-green)]"})})})}],T=({song:e})=>{var j;const[t,F]=l.useState(e.price),[o,I]=l.useState(e.status),M=[{value:0,label:"Miễn phí"},{value:1,label:"Premium"}],i=[{value:e.status,label:e.status==3?"Chờ duyệt":e.status==1?"Công khai":"Riêng tư"}];e.status==3&&(i.push({value:0,label:"Riêng tư"}),i.push({value:1,label:"Công khai"})),e.status==1&&i.push({value:0,label:"Riêng tư"}),e.status==0&&i.push({value:1,label:"Công khai"});const R=async()=>{let s={};if(t!=e.price&&(s.price=t),o!=e.status&&(s.status=o),Object.keys(s).length>0)try{const n=await q(e.id,s);console.log(n),(n==null?void 0:n.status)===200&&(g(E=>E.map(v=>v.id===e.id?n.data.message:v)),u({}),h.success("Cập nhật bài hát thành công"))}catch(n){h.error(n.message)}else h.error("Vui lòng chọn giá trị")};return a.jsx("div",{className:"z-10 absolute top-0 left-0 w-full h-full bg-black/80 flex flex-col items-center justify-center gap-2",children:a.jsxs("div",{className:"flex flex-col gap-2 w-fit",children:[a.jsx(D,{className:"text-white text-3xl cursor-pointer self-end translate-x-[100%]",onClick:()=>u({})}),a.jsxs("div",{className:"p-5 bg-[var(--dark-gray)] rounded-md shadow-md w-full h-fit flex flex-col gap-5",children:[a.jsxs("div",{className:"flex gap-5 items-center w-full h-fit ",children:[a.jsx("img",{loading:"lazy",src:e.image,alt:"Ảnh bài hát",className:"w-[10vw] square object-cover rounded-md "}),a.jsxs("div",{className:"text-white flex flex-col gap-2 justify-end h-full",children:[a.jsx("div",{className:"text-sm ",children:"Bài hát"}),a.jsx("div",{className:"text-2xl font-bold",children:e.name}),a.jsx("div",{className:"text-sm text-gray-400",children:(j=e.artists_data)==null?void 0:j.map(s=>s.name).join(", ")}),a.jsx("div",{className:"text-sm text-gray-400",children:e.date})]})]}),a.jsxs("div",{className:"flex gap-5 items-center ",children:["Nghe:",a.jsx(d,{style:{width:120},onChange:F,defaultValue:t,children:M.map(s=>a.jsx(x,{value:s.value,children:s.label},s.value))})]}),a.jsxs("div",{className:"flex gap-5  items-center",children:["Trạng thái:",a.jsx(d,{style:{width:120},onChange:I,defaultValue:o,children:i.map(s=>a.jsx(a.Fragment,{children:s.value!==-1&&a.jsx(x,{value:s.value,children:s.label},s.value)}))})]}),a.jsx("button",{onClick:R,className:"cursor-pointer self-center bg-[var(--light-gray2)] w-fit text-white p-2 rounded-sm my-2",children:"Lưu"})]})]})})};return a.jsx("div",{children:w?a.jsx("div",{className:"loader-container min-h-[50vh] flex justify-center items-center",children:a.jsx("span",{className:"loader",children:" "})}):a.jsxs("div",{className:"flex flex-col gap-7",children:[!!Object.keys(p).length&&a.jsx(T,{song:p}),a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-5",children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"Tên bài hát",className:"bg-[var(--light-gray2)] text-white p-2 rounded-full w-full focus:outline-none placeholder-[var(--light-gray3)] text-sm pl-10",value:r,onChange:e=>y(e.target.value)}),a.jsx(z,{className:"absolute left-2 top-0 translate-x-[50%] translate-y-[50%] text-[var(--light-gray3)]"})]}),a.jsx(d,{style:{width:120},placeholder:"Chọn một mục",onChange:b,defaultValue:c,children:H.map(e=>a.jsx(x,{value:e.value,children:e.label},e.value))})]})}),a.jsx(U,{columns:V,dataSource:N,pagination:{pageSize:6},scrollToFirstRowOnChange:!0,rowKey:"id"})]})})};export{W as default};
