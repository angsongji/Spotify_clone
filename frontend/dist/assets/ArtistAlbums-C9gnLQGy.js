import{a as E,r as o,b as j,j as e,am as q,bt as z,an as x,bu as b,D as B,bv as P,al as U,bx as Y,v as R,au as H}from"./index-COxCwWZM.js";import{F as c,U as W}from"./UploadImage-aFuG0uTa.js";import{M as X,D as $}from"./index-Bzd2ChEI.js";import{I as G}from"./index-E8j24bxo.js";import"./row-BZ7R_aan.js";import"./addEventListener-C0BB_NjA.js";import"./Input-2CY0lWXu.js";const{Option:v}=x,J=[{value:-1,label:"Tất cả"},{value:0,label:"Riêng tư"},{value:1,label:"Công khai"}],le=()=>{var f;const d=E(a=>a.user.user),[g,w]=o.useState(""),[h,y]=o.useState(-1),[C,m]=o.useState(!1),[i]=c.useForm();j();const[u,p]=o.useState(!1),N=({options:a,onChange:s})=>e.jsx(x,{style:{width:100},placeholder:"Chọn một mục",onChange:s,defaultValue:h,children:a.map(r=>e.jsx(v,{value:r.value,children:r.label},r.value))}),k=a=>{w(a.target.value)},S=a=>{y(a)},F=()=>{const a=[{key:"1",label:"Cập nhật",onClick:()=>alert("Clicked on 1st menu item")},{key:"2",label:"Xóa",onClick:()=>alert("Clicked on 2nd menu item")}];return e.jsx(B,{menu:{items:a},trigger:["click"],children:e.jsx(P,{})})},V=({type:a})=>{m(!0),m(!0)},D=async({type:a})=>{try{p(!0);const s=await i.validateFields();a==="add"&&await _(s),m(!1),i.resetFields()}catch(s){console.log("Validation Failed:",s)}finally{p(!1)}},_=async a=>{console.log("add album ",a);try{let s="";if(a.image){const l=new FormData;l.append("file",a.image);const t=await U(l);if(t.status===200)s=encodeURI(t.data.message);else throw new Error("Image upload failed")}console.log("image ",s);const r={name:a.name,artist_id:d.id,image:s,release_date:a.release_date},n=await Y(r);if((n==null?void 0:n.status)===201)R(l=>({...l,albums_data:[...l.albums_data,n.data.message]})),await Promise.all(a.songs.map(async l=>{try{await H(l,{album_id:n.data.message.id})}catch(t){console.error(`❌ Cập nhật thất bại cho song ${l}`,t)}}));else throw new Error("Failed to add album")}catch(s){console.error("Error adding song:",s)}},I=()=>{m(!1)},M=()=>e.jsx(X,{title:"Thêm album mới",open:C,onOk:()=>D({type:"add"}),onCancel:I,okText:u?e.jsx(b,{}):"Submit",cancelText:"Cancel",width:700,confirmLoading:u,children:u?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang xử lý..."]}):e.jsx(c,{form:i,layout:"vertical",children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("div",{className:"w-fit border-r-1 border-black pr-4",children:e.jsx(c.Item,{label:"Image",name:"image",rules:[{required:!0,message:"Vui lòng chọn ảnh bài hát!"}],children:e.jsx(W,{form:i})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(c.Item,{label:"Tên album",name:"name",rules:[{required:!0,message:"Vui lòng nhập tên album!"}],children:e.jsx(G,{className:"!w-[300px]"})}),e.jsx(c.Item,{label:"Ngày phát hành",name:"release_date",rules:[{required:!0,message:"Vui lòng chọn ngày phát hành!"}],children:e.jsx(A,{form:i})}),e.jsx(c.Item,{label:"Bài hát trong album",name:"songs",children:e.jsx(L,{data:d.songs_data.filter(a=>a.status!=2&&a.album_id==""),form:i})})]})]})})}),A=({form:a})=>{const[s,r]=o.useState(null),n=(l,t)=>{r(t),a.setFieldsValue({release_date:t})};return e.jsx("div",{children:e.jsx($,{onChange:n,format:"YYYY-MM-DD"})})},L=({data:a,form:s})=>{const[r,n]=o.useState([]),l=t=>{n(t),s.setFieldsValue({songs:t})};return e.jsx("div",{children:e.jsx(x,{mode:"multiple",value:r,onChange:l,placeholder:"Chọn nhiều",style:{width:"100%"},showSearch:!0,filterOption:(t,T)=>T.children.toLowerCase().includes(t.toLowerCase()),children:a.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))})})},O=({album:a})=>(j(),e.jsxs("div",{className:"relative w-40 bg-[var(--light-gray2)] h-fit p-3 rounded-lg transition-transform transform hover:scale-105 duration-300 cursor-pointer flex flex-col",children:[e.jsx("img",{loading:"lazy",src:a.image,alt:a.name,className:"w-full h-32 object-cover aspect-square rounded-sm"}),e.jsxs("div",{className:"w-full mt-2 flex flex-col gap-2",children:[e.jsx("div",{className:"text-white font-semibold overflow-hidden whitespace-nowrap text-ellipsis w-full",children:a.name}),e.jsx("div",{className:"text-gray-400 text-sm",children:a.release_date})]}),e.jsx("div",{className:"z-1 absolute bottom-0 right-0 hover:text-white translate-x-[-50%] translate-y-[-100%]",children:e.jsx(F,{})}),a.status==0&&e.jsx("div",{className:"absolute top-0 left-0 bg-[var(--light-gray1)] opacity-50  transition-opacity duration-300  bottom-0 right-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-gray-500 text-sm font-semibold flex items-center gap-2",children:[e.jsx(b,{})," Riêng tư"]})})]}));return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center justify-between m-5 mb-7",children:[d.albums_data==null?e.jsx("div",{className:"text-center text-white text-sm",children:"Bạn chưa có album nào"}):e.jsxs("div",{className:"flex items-center gap-5 ",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Nhập tên album",className:"bg-[var(--light-gray2)] !text-white p-2 rounded-full w-96 focus:outline-none placeholder-[var(--light-gray3)] text-sm pl-10",value:g,onChange:k}),e.jsx(q,{className:"absolute left-2 top-0 translate-x-[50%] translate-y-[50%] text-[var(--light-gray3)]"})]}),e.jsx(N,{options:J,onChange:S})]}),e.jsxs("div",{onClick:()=>V({type:"add"}),className:"group rounded-xl transition-all duration-300 hover:bg-[var(--main-green)] hover:text-black text-[var(--light-gray3)] text-base cursor-pointer w-fit bg-[var(--light-gray1)] p-2 flex items-center gap-2",children:[e.jsx(z,{}),e.jsx("span",{className:"hidden group-hover:inline text-xs ",children:"Thêm album"})]})]}),e.jsx("div",{className:"h-[70vh] overflow-y-auto  custom-scroll",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5 justify-items-center",children:(f=d.albums_data)==null?void 0:f.map((a,s)=>a.status!=2&&a.name.toLowerCase().includes(g.toLowerCase())&&(h==-1||a.status==h)&&e.jsx(O,{album:a},s))})}),e.jsx(M,{})]})};export{le as default};
