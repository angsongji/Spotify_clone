import{u as w,a as d,b as y,j as s,c as A,r as p,f as D,d as S,s as k,e as C,g as f,h as j,i as v}from"./index-COxCwWZM.js";import{A as P}from"./AlbumCard-CYTIYSm7.js";import{A as _}from"./ArtistCard-Bq_-Tdc4.js";const b=({song:t})=>{var o;const{formatTime:c,handleClickSong:g}=w(),n=d(i=>i.music.currentSong),l=(n==null?void 0:n.id)===t.id,m=y();return s.jsxs("div",{className:"w-full cursor-pointer flex gap-3 shadow-lg overflow-hidden items-center hover:bg-[var(--light-gray1)] p-2 rounded-sm",onClick:()=>{g(t.id),m(`/song/${t.id}`)},children:[s.jsx("img",{loading:"lazy",src:t.image,alt:"Album Cover",className:"w-15 h-15 object-cover aspect-square rounded-sm"}),s.jsxs("div",{className:"text-[var(--light-gray3)] w-full flex flex-col",children:[s.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-center",children:[s.jsx("div",{className:"text-base font-semibold text-white w-full overflow-hidden whitespace-nowrap text-ellipsis",style:l?{color:"var(--main-green)",fontSize:"18px"}:{},children:t.name}),s.jsx("span",{className:`${t.price!==0?"bg-[var(--main-green)]":"transparent"} text-black text-xs px-2 py-1 rounded-sm font-semibold`,children:t.price!==0?"Premium":""})]}),s.jsx("div",{className:"text-xs",children:(o=t.artists_data)==null?void 0:o.map((i,x)=>s.jsxs("span",{className:"cursor-pointer hover:text-white",onClick:e=>{e.stopPropagation(),m(`/artist/${i.id}`)},children:[i.name,x<t.artists_data.length-1?", ":""]},i.id))}),s.jsxs("div",{className:"text-xs mt-1 flex justify-between",children:[s.jsx("span",{children:t.date}),s.jsx("span",{children:c(t.duration)})]})]})]})},T=()=>{const t=d(e=>e.user.user),c=d(e=>e.music.songs),g=d(e=>e.music.albums),n=d(e=>e.music.artists);y();const l=A(),[m,o]=p.useState(!1);p.useEffect(()=>{(async()=>{o(!0);try{const[a,r]=await Promise.all([D(),S()]);l(k(a.data.message)),l(C(r.data.message))}catch(a){console.error("Lỗi khi tải albums/artists:",a)}})()},[]),p.useEffect(()=>{(async()=>{if(!t||(t==null?void 0:t.purchases_data.length)==0){try{const r=(await f()).data.message.filter(h=>h.status==1);l(j(r)),l(v(r))}catch(a){console.error("Lỗi khi tải hoặc xử lý songs:",a)}finally{o(!1)}return}try{let r=(await f()).data.message;if(t.purchases_data.length>0){const h=t.purchases_data[0],u=new Date(h.purchase_date);u.setDate(u.getDate()+h.date),u>=new Date&&(r=r.map(N=>({...N,price:0})))}l(j(r)),l(v(r))}catch(a){console.error("Lỗi khi tải hoặc xử lý songs:",a)}finally{o(!1)}})()},[]);const i=({title:e})=>s.jsxs("div",{className:"flex justify-between items-center text-green-500 mb-10",children:[s.jsx("h2",{className:"text-white text-2xl font-bold",children:e}),s.jsx("button",{className:"text-gray-400 hover:text-white transition cursor-pointer text-sx",children:"Hiện tất cả"})]}),x=()=>s.jsxs("div",{className:"my-8",children:[s.jsx(i,{title:"Popular Artists"}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-5",children:n.map((e,a)=>e.status!==0&&s.jsx(_,{artist:e},a))})]});return m?s.jsx("div",{className:"loader-container min-h-[50vh]",children:s.jsx("span",{className:"loader",children:" "})}):s.jsxs("div",{className:"bg-gradient-to-tl from-stone-900 to-neutral-700 p-6 py-10 min-h-screen flex flex-col gap-20 ",children:[s.jsxs("div",{children:[s.jsx(i,{title:"Popular Albums"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 2xl:grid-cols-6 gap-5",children:g.map((e,a)=>e.status===1&&s.jsx(P,{album:e},a))})]}),s.jsx(x,{}),c.length!==0&&s.jsxs("div",{children:[s.jsx(i,{title:"Thịnh hành"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5",children:c.map((e,a)=>e.status===1&&s.jsx(b,{song:e},a))})]}),c.length!==0&&s.jsxs("div",{children:[s.jsx(i,{title:"Mới phát hành"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5",children:c.map((e,a)=>e.status===1&&s.jsx(b,{song:e},a))})]})]})};export{T as default};
